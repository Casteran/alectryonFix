\documentclass[a4paper]{article}
% generated by Docutils <http://docutils.sourceforge.net/>
% rubber: set program xelatex
\usepackage{fontspec}
% \defaultfontfeatures{Scale=MatchLowercase}
% straight double quotes (defined T1 but missing in TU):
\ifdefined \UnicodeEncodingName
  \DeclareTextCommand{\textquotedbl}{\UnicodeEncodingName}{%
    {\addfontfeatures{RawFeature=-tlig,Mapping=}\char34}}%
\fi
\usepackage{ifthen}
\usepackage{alltt}
\usepackage{color}

%%% Custom LaTeX preamble

\setmainfont{Linux Libertine O}
\setsansfont{Linux Biolinum O}
\setmonofont[Scale=MatchLowercase]{Fira Code}

\usepackage{xeCJK}
\setCJKmainfont{Noto Sans CJK JP}
\setCJKsansfont{Noto Sans CJK JP}
\setCJKmonofont[Scale=0.9777]{Noto Sans CJK JP}

%%% User specified packages and stylesheets
\usepackage{alectryon}
\usepackage{tango_subtle}

%%% Fallback definitions for Docutils-specific commands
% basic code highlight:
\providecommand*\DUrolecomment[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUroledeleted[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUrolekeyword[1]{\textbf{#1}}
\providecommand*\DUrolestring[1]{\textit{#1}}

% inline markup (custom roles)
% \DUrole{#1}{#2} tries \DUrole#1{#2}
\providecommand*{\DUrole}[2]{%
  \ifcsname DUrole#1\endcsname%
    \csname DUrole#1\endcsname{#2}%
  \else
    % backwards compatibility: try \docutilsrole#1{#2}
    \ifcsname docutilsrole#1\endcsname%
      \PackageWarningNoLine{docutils}{Command prefix "docutilsrole" is
         deprecated, \MessageBreak use `\protect\DUrole #1`}
      \csname docutilsrole#1\endcsname{#2}%
    \else%
      #2%
    \fi%
  \fi%
}
% hyperlinks:
\ifthenelse{\isundefined{\hypersetup}}{
  \usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
  \usepackage{bookmark}
  \urlstyle{same} % normal text font (alternatives: tt, rm, sf)
}{}
\hypersetup{
  pdftitle={Using references},
}

\title{Using references%
  \label{using-references}}
\author{}
\date{}

%%% Body
\begin{document}
\maketitle

To compile:

\begin{quote}
\begin{alltt}
$ alectryon references.rst
    # ReST → HTML; produces ‘references.html’
$ DOCUTILSCONFIG=references.docutils.conf alectryon \textbackslash{}
    references.rst -o references.xe.tex --latex-dialect xelatex
    # ReST → HTML; produces ‘references.xe.tex’
\end{alltt}
\end{quote}

Alectryon supports references to individual sentences and hypotheses within a code fragment.  The easiest way to reference a sentence is to use \texttt{:mref:`search-term`}.  Alectryon will search for that text and automatically add a label to the first matching sentence of the proof.  For example:

\begin{quote}
\begin{alectryon}
  % Generator: Alectryon
  \sep
  \anchor{setup}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Fixpoint}~\PY{n+nf}{plus\PYZus{}comm}~\PY{o}{(}\PY{n+nv}{n}~\PY{n+nv}{m}\PY{o}{:}~\PY{n}{nat}\PY{o}{)}~\PY{o}{\PYZob{}}\PY{n+nv}{struct}~\PY{n+nv}{n}\PY{o}{\PYZcb{}}~\PY{o}{:}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}\PY{o}{.}\anchor{references-rst-fixpoint-plus-comm0}\mrefmarker{1}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m}{\PY{n}{nat}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Proof}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m}{\PY{n}{nat}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{n+nb}{destruct}~\PY{n}{n}~\PY{n+nb}{eqn}\PY{o}{:}\PY{n}{Heq}\PY{o}{.}\anchor{references-rst-destruct-n0}\mrefmarker{◉}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \anchor{references-rst-s-destruct-n-g-10}
          \sep
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}\anchor{references-rst-s-destruct-n-g-1-h-plus-comm0}\mrefmarker{7}}
            \sep
            \hyp{n, m}{\PY{n}{nat}\anchor{references-rst-s-destruct-n-g-1-h-n0}\mrefmarker{3}}
            \sep
            \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{l+m+mi}{0}\anchor{references-rst-s-destruct-n-g-1-h-n-00}\mrefmarker{4}}
          \end{hyps}
          \sep
          \infrule{\mrefmarker{2}}
          \sep
          \begin{conclusion}
            \PY{l+m+mi}{0}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{l+m+mi}{0}\anchor{references-rst-s-destruct-n-ccl0}\mrefmarker{5}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \anchor{references-rst-s-destruct-n-g-20}
            \sep
            \begin{hyps}
              \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
              \sep
              \hyp{n, m, n0}{\PY{n}{nat}}
              \sep
              \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{n}{S}~\PY{n}{n0}}
            \end{hyps}
            \sep
            \infrule{\mrefmarker{6}}
            \sep
            \begin{conclusion}
              \PY{n}{S}~\PY{n}{n0}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n0}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{o}{\PYZhy{}}~\PY{c}{(*~Base~case~*)}\anchor{references-rst-setup-s-base-case0}\mrefmarker{8}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m}{\PY{n}{nat}}
            \sep
            \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{l+m+mi}{0}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{l+m+mi}{0}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{l+m+mi}{0}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb}{rewrite}~\PY{o}{\PYZlt{}\PYZhy{}}~\PY{n}{plus\PYZus{}n\PYZus{}O}\PY{o}{;}~\PY{n+nb+bp}{reflexivity}\PY{o}{.}
    \end{input}
  \end{sentence}
\end{alectryon}

The \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{kn}{Fixpoint}}}}} command (\hyperref[references-rst-fixpoint-plus-comm0]{1}) indicates that we are beginning an inductive proof.
\end{quote}

Optionally, the label can be picked manually, using \texttt{:mref:`label <target>`}:

\begin{quote}
The proof starts with a case analysis, indicated by “\hyperref[references-rst-destruct-n0]{◉}”.
\end{quote}

Instead of whole sentences, is possible to refer to individual goals and hypotheses:

\begin{quote}
In the first case (\hyperref[references-rst-s-destruct-n-g-10]{2}), we see the variable \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{n}{n}}}}} in the context (\hyperref[references-rst-s-destruct-n-g-1-h-n0]{3}), and we see that it is \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{mi}{0}}}}} (\hyperref[references-rst-s-destruct-n-g-1-h-n-00]{4}); notice how the conclusion of the first goal \hyperref[references-rst-s-destruct-n-ccl0]{5} does not mention \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{n}{n}}}}} (it says \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{mi}{0}}}}} instead).  In the second case \hyperref[references-rst-s-destruct-n-g-20]{6}, the conclusion mentions \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{n}{S} \DUrole{n}{n0}}}}} instead.
\end{quote}

Note that we can safely refer multiple times to the same object, even using a different reference:

\begin{quote}
\begin{itemize}
\item \hyperref[references-rst-s-destruct-n-g-1-h-plus-comm0]{7}

\item \hyperref[references-rst-s-destruct-n-g-1-h-plus-comm0]{7}

\item \hyperref[references-rst-s-destruct-n-g-1-h-plus-comm0]{7}
\end{itemize}
\end{quote}

To allow forward- and back-references, counters are not reset from one block to the next:

\begin{quote}
% 

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    ~~
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{o}{\PYZhy{}}~\PY{c}{(*~Induction~*)}\anchor{references-rst-induction0}\mrefmarker{9}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m, n0}{\PY{n}{nat}}
            \sep
            \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{n}{S}~\PY{n}{n0}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{S}~\PY{n}{n0}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n0}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb}{simpl}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m, n0}{\PY{n}{nat}}
            \sep
            \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{n}{S}~\PY{n}{n0}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{S}~\PY{o}{(}\PY{n}{n0}~\PY{o}{+}~\PY{n}{m}\PY{o}{)}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n0}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb}{rewrite}~\PY{o}{(}\PY{n}{plus\PYZus{}comm}~\PY{n}{n0}\PY{o}{).}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m, n0}{\PY{n}{nat}}
            \sep
            \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{n}{S}~\PY{n}{n0}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{S}~\PY{o}{(}\PY{n}{m}~\PY{o}{+}~\PY{n}{n0}\PY{o}{)}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n0}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb}{rewrite}~\PY{n}{plus\PYZus{}n\PYZus{}Sm}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{plus\char`\_comm}{\PY{k+kr}{forall}~\PY{n+nv}{n}~\PY{n+nv}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{n}~\PY{o}{+}~\PY{n}{m}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{n}}
            \sep
            \hyp{n, m, n0}{\PY{n}{nat}}
            \sep
            \hyp{Heq}{\PY{n}{n}~\PY{o}{=}~\PY{n}{S}~\PY{n}{n0}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{m}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n0}~\PY{o}{=}~\PY{n}{m}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n0}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb+bp}{reflexivity}\PY{o}{.}\nl
    \end{input}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Qed}\PY{o}{.}
    \end{input}
  \end{sentence}
\end{alectryon}

\begin{itemize}
\item Bullets (\texttt{-}, \texttt{+}, \texttt{*}) delimit subproofs (\hyperref[references-rst-setup-s-base-case0]{8}, \hyperref[references-rst-induction0]{9})

\item It all started at \hyperref[references-rst-fixpoint-plus-comm0]{1}
\end{itemize}
\end{quote}

Custom counter styles can be defined like using the \texttt{.. role::} directive and the \texttt{:counter-style:} option:

Here is how it looks:

\begin{quote}
The following commands print information about an identifier \hyperref[references-rst-cp-s-about0]{α}, print its definition \hyperref[references-rst-cp-s-print0]{β}, and compute the type of a term \hyperref[references-rst-cp-s-check0]{γ} or its reduction \hyperref[references-rst-cp-s-compute0]{δ}.

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \anchor{cp}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{About}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}\PY{o}{.}\anchor{references-rst-cp-s-about0}\mrefmarker{α}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{o}{:}~\PY{n}{nat}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{nat}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{nat}\nl
          \nl
          \PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{k+kr}{is}~\PY{n}{not}~\PY{n}{universe}~\PY{n}{polymorphic}\nl
          \PY{k+kn}{Arguments}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{o}{(}\PY{n}{\PYZus{}}~\PY{n}{\PYZus{}}\PY{o}{)\PYZpc{}}\PY{n}{nat\PYZus{}scope}\nl
          \PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{k+kr}{is}~\PY{n}{transparent}\nl
          \PY{n}{Expands}~\PY{n}{to}\PY{o}{:}~\PY{n}{Constant}~\PY{n}{Coq}\PY{o}{.}\PY{n}{Init}\PY{o}{.}\PY{n}{Nat}\PY{o}{.}\PY{n}{add}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Print}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}\PY{o}{.}\anchor{references-rst-cp-s-print0}\mrefmarker{β}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{o}{=}~\nl
          \PY{k+kr}{fix}~\PY{n}{add}~\PY{o}{(}\PY{n}{n}~\PY{n}{m}~\PY{o}{:}~\PY{n}{nat}\PY{o}{)}~\PY{o}{\PYZob{}}\PY{k+kr}{struct}~\PY{n}{n}\PY{o}{\PYZcb{}}~\PY{o}{:}~\PY{n}{nat}~\PY{o}{:=}\nl
          ~~\PY{k+kr}{match}~\PY{n}{n}~\PY{k+kr}{with}\nl
          ~~\PY{o}{|}~\PY{l+m+mi}{0}~\PY{o}{=\PYZgt{}}~\PY{n}{m}\nl
          ~~\PY{o}{|}~\PY{n}{S}~\PY{n}{p}~\PY{o}{=\PYZgt{}}~\PY{n}{S}~\PY{o}{(}\PY{n}{add}~\PY{n}{p}~\PY{n}{m}\PY{o}{)}\nl
          ~~\PY{k+kr}{end}\nl
          ~~~~~\PY{o}{:}~\PY{n}{nat}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{nat}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{nat}\nl
          \nl
          \PY{k+kn}{Arguments}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{o}{(}\PY{n}{\PYZus{}}~\PY{n}{\PYZus{}}\PY{o}{)\PYZpc{}}\PY{n}{nat\PYZus{}scope}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Check}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-check0}\mrefmarker{γ}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{l+m+mi}{2}~\PY{o}{+}~\PY{l+m+mi}{3}\nl
          ~~~~~\PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Compute}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-compute0}\mrefmarker{δ}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{l+m+mi}{5}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{txt}
    \nl
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Eval}~\PY{n+nb}{simpl}~\PY{k+kr}{in}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-simpl0}\mrefmarker{い}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{l+m+mi}{5}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Eval}~\PY{n+nb}{cbn}~\PY{k+kr}{in}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-cbn0}\mrefmarker{ろ}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{l+m+mi}{5}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Eval}~\PY{n+nb}{cbv}~\PY{k+kr}{in}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-cbv0}\mrefmarker{は}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{l+m+mi}{5}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Eval}~\PY{n+nb}{lazy}~\PY{k+kr}{in}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-lazy0}\mrefmarker{に}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{l+m+mi}{5}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Eval}~\PY{n+nb}{vm\PYZus{}compute}~\PY{k+kr}{in}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-vm-compute0}\mrefmarker{ほ}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{l+m+mi}{5}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Eval}~\PY{n+nb}{pattern}~\PY{l+m+mi}{2}~\PY{k+kr}{in}~\PY{n}{Nat}\PY{o}{.}\PY{n}{add}~\PY{l+m+mi}{2}~\PY{l+m+mi}{3}\PY{o}{.}\anchor{references-rst-cp-s-pattern0}\mrefmarker{へ}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{o}{=}~\PY{o}{(}\PY{k+kr}{fun}~\PY{n+nv}{n}~\PY{o}{:}~\PY{n}{nat}~\PY{o}{=\PYZgt{}}~\PY{n}{n}~\PY{o}{+}~\PY{n}{S}~\PY{n}{n}\PY{o}{)}~\PY{l+m+mi}{2}\nl
          \PY{o}{:}~\PY{n}{nat}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
\end{alectryon}

The second batch of commands perform reduction with a custom strategy: \hyperref[references-rst-cp-s-simpl0]{い} \hyperref[references-rst-cp-s-cbn0]{ろ} \hyperref[references-rst-cp-s-cbv0]{は} \hyperref[references-rst-cp-s-lazy0]{に} \hyperref[references-rst-cp-s-vm-compute0]{ほ} \hyperref[references-rst-cp-s-pattern0]{へ}.
\end{quote}

Each inline reference is a link to the corresponding code fragment.

\end{document}
